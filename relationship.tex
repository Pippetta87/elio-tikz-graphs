% the tikz-er2.sty package is available 
% http://tagus.inesc-id.pt/~pcalado/tikzer2/tikz-er2.
\documentclass[../main.tex]{subfiles}

\begin{document}

\thispagestyle{empty}

%\tikzstyle{every entity} = [top color=white, bottom color=blue!30, draw=blue!50!black!100, drop shadow,text width=2cm]
%\tikzstyle{every weak entity} = [drop shadow={shadow xshift=.7ex, 
%                                 shadow yshift=-.7ex}]
%\tikzstyle{every isa} = [top color=white, bottom color=green!20, draw=green!50!black!100, drop shadow,text width=2cm]

\tikzstyle{every entity} = [fill=blue!30, draw=blue!50!black!100, drop shadow,text width=2cm]

\tikzstyle{every weak entity}=[fill=black!20!white!100]

\tikzstyle{every attribute} = [fill=yellow!100, draw=yellow, node distance=1cm, drop shadow,text width=1.5cm, fill opacity=0.5]

\tikzstyle{every relationship} = [top color=white, bottom color=red!20, draw=red!50!black!100, drop shadow,text width=2cm]

\centering
\scalebox{.25}{
\begin{tikzpicture}[node distance=1.5cm, every edge/.style={link}]

  \node[entity] (ssm) at (0,0) {SSM};
\draw[link,<-]  (ssm.120)--++(120:2cm) node[attribute,anchor=120+180] (hydro) {Equilibrio idrostatico};
\draw[link,<-]  (ssm.160)--++(160:2cm) node[attribute,anchor=160+180] (thermal) {Equilibrio termico locale};
\draw[link,<-]  (ssm.200)--++(200:2cm) node[attribute, anchor=200+180] (opacity) {Equilibrio radiativo + criterio di Schwartzchild};

\node[relationship] (calibration) [above =3cm of ssm] {Calibrazione luminosit\'a e raggio} edge[<-] (ssm);

\node[entity] (unphys) [below=2cm of ssm] {Incertezze fisica del modello} edge [<-] (ssm);
\draw[link,<->] (unphys.200)--++(200:4cm) node[attribute, anchor=200+180] (diffusion) {Diffusione};
\draw[link,<->] (unphys.215)--++(215:2cm) node[attribute, anchor=215+180] (MLT) {Modello convezione: MLT.};
\draw[link,<->] (unphys.250)--++(250:4cm) node[attribute, anchor=250+180] (modefreqsurf) {Influenza della zona superficiale sulle frequenze delle oscillazioni};

\node[entity] (surfaceobs) [above right=3cm and 3cm of ssm] {Osservabili stellari};
\draw[link,->] (surfaceobs.90)--++(90:2cm) node[attribute, anchor=90+180] {Misura metellicit\'a superficiale};

\node[entity] (modelobs) [below=3cm of surfaceobs.south east,anchor=north] {Discrepanze modello/osservazioni}; 
\node[entity,anchor=north west] (corrections) at (modelobs.south east) {Correzioni} edge [->,in=
30,out=60] (ssm);
\node[entity,anchor=north west] (sismobs) at (surfaceobs.south east) {Osservabili sismologiche};
\draw[link,->]  (sismobs.45)--++(45:3cm) node[attribute, anchor=45+180] (freqs) {Frequenze oscillazioni adiabatiche};
\draw[link,->] (sismobs.5)--++(5:2cm) node[attribute, anchor=5+180] (radiuscz) {Raggio fondo zona convettiva};
\draw[link,->] (sismobs.8)--++(8:4cm) node[attribute, anchor=8+180] (heliumenv) {$Y_{ph}$};
\draw[link,->] (sismobs.345)--++(345:5cm) node[attribute, anchor=345+180] (soundspeed) {Velocit\'a del suono (isothermal): $c_s(r)/u(r)$};
\draw[link,->] (sismobs.30)--++(30:4cm) node[attribute,anchor=30+180] (densitybcz) {Densit\'a fondo zona convettiva $\rho_{cz}$};
\draw[link,->] (ssm.315)--++(315:2cm) node[entity, anchor=315+180] (ssmoscmodes) {Soluzione problema agli autovalori modi normali adiabatici};
\node[entity,below=1.5cm of modelobs] (inversion)  {Tecniche di inversione};
\draw[link,->] (sismobs.215)--(inversion.50);

\node[entity,anchor=north west] (neutrinoflux) at (sismobs.south east) {Flusso neutrini solari};

\draw[link,<->] (surfaceobs.200) -- (unphys.50) node [sloped,pos=0.5, anchor=north] (stellaracc) {accuratezza};
\draw[link,<->] (sismobs.270) -- (unphys.60) node [sloped,pos=0.5, anchor=south] (sismacc) {accuratezza};

\node[draw,purple,fit=(hydro)(thermal)(opacity)(unphys)(ssm),ellipse,label={[purple,label distance=1cm]120:Modello Solare standard}] (ssmapprox) at (hydro.west) {};
\node[weak entity,anchor=east] (ssmapproxlist) at (ssmapprox.west) {Oltre il SSM:
\begin{itemize*} \item Composizione superficiale \item modelli idrodinamici dell'atmosfera e inclusione di effetti NLTE \item Effetto screening degli elettroni sulle reazioni nucleari\end{itemize*} };

\end{tikzpicture}

}

\end{document}
