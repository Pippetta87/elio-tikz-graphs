% the tikz-er2.sty package is available at:
% http://tagus.inesc-id.pt/~pcalado/tikzer2/tikz-er2.
\documentclass[../main.tex]{subfiles}

\begin{document}

\thispagestyle{empty}

%\tikzstyle{every entity} = [top color=white, bottom color=blue!30, draw=blue!50!black!100, drop shadow,text width=2cm]
%\tikzstyle{every weak entity} = [drop shadow={shadow xshift=.7ex, 
%                                 shadow yshift=-.7ex}]
%\tikzstyle{every isa} = [top color=white, bottom color=green!20, draw=green!50!black!100, drop shadow,text width=2cm]

\tikzstyle{every entity} = [fill=blue!30, draw=blue!50!black!100, drop shadow,text width=2cm]

\tikzstyle{every weak entity}=[fill=black!20!white!100]

\tikzstyle{every attribute} = [fill=yellow!100, draw=yellow, node distance=1cm, drop shadow,text width=1.5cm, fill opacity=0.5]

\tikzstyle{every relationship} = [top color=white, bottom color=red!20, draw=red!50!black!100, drop shadow,text width=2cm]

\centering
\scalebox{.25}{
\begin{tikzpicture}[node distance=1.5cm, every edge/.style={link}]

  \node[entity] (ssm) at (0,0) {SSM};
\draw[link,<-]  (ssm.120)--++(120:2cm) node[attribute,anchor=120+180] (hydro) {Equilibrio idrostatico};
\draw[link,<-]  (ssm.160)--++(160:2cm) node[attribute,anchor=160+180] (thermal) {Equilibrio termico locale};
\draw[link,<-]  (ssm.200)--++(200:2cm) node[attribute, anchor=200+180] (opacity) {Equilibrio radiativo + criterio di Schwartzchild};

\node[relationship] (calibration) [above =3cm of ssm] {Calibrazione luminosit\'a e raggio} edge[<-] (ssm);

\node[entity] (unphys) [right=1.5cm of ssm] {Incertezze fisica del modello} edge [<-] (ssm);
\draw[link,<->] (unphys.100)--++(100:4cm) node[attribute, anchor=100+180] (diffusion) {Diffusione};
\draw[link,<->] (unphys.115)--++(115:2cm) node[attribute, anchor=115+180] (MLT) {Modello convezione: MLT.};
\draw[link,<->] (unphys.285)--++(285:5cm) node[attribute, anchor=285+180] (modefreqsurf) {Influenza della zona superficiale sulle frequenze delle oscillazioni};

\node[entity] (surfaceobs) [above right=3cm and 3cm of ssm] {Osservabili stellari};
\draw[link,->] (surfaceobs.90)--++(90:2cm) node[attribute, anchor=90+180] {Misura metellicit\'a superficiale};

\node[entity] (modelobs) [below=1.5cm of ssm] {Discrepanze modello/osservazioni}; 
\node[entity] at (modelobs.south east) (corrections) [anchor=north west] {Correzioni} edge [->,in=[30],out=[60]] (ssm);
\node[entity,anchor=north west] (sismobs) at (surfaceobs.south east) {Osservabili sismologiche};
\draw[link,->]  (sismobs.45)--++(45:3cm) node[attribute, anchor=45+180] (freqs) {Frequenze oscillazioni adiabatiche};
\draw[link,->] (sismobs.5)--++(5:2cm) node[attribute, anchor=5+180] (radiuscz) {Raggio fondo zona convettiva};
\draw[link,->] (sismobs.8)--++(8:4cm) node[attribute, anchor=8+180] (heliumenv) {$Y_{ph}$};
\draw[link,->] (sismobs.345)--++(345:5cm) node[attribute, anchor=345+180] (soundspeed) {Velocit\'a del suono (isothermal): $c_s(r)/u(r)$};
\draw[link,->] (sismobs.30)--++(30:4cm) node[attribute,anchor=30+180] (densitybcz) {Densit\'a fondo zona convettiva $\rho_{cz}$};

\node[entity,anchor=north west] (neutrinoflux) at (sismobs.south east) {Flusso neutrini solari};

\draw[link,<->] (surfaceobs.180) -- (unphys.170) node [pos=0.5, right] (stellaracc) {accuratezza};
\draw[link,<->] (sismobs.340) -- (unphys.20) node [pos=0.5, left] (sismacc) {accuratezza};

\node[draw,purple,fit=(hydro)(thermal)(opacity)(ssm),ellipse,label={[purple,label distance=1cm]120:Oltre il Modello Solare standard}] (ssmapprox) at (hydro.west) {};
\node[weak entity,anchor=east] (ssmapproxlist) at (ssmapprox.west) { \begin{itemize*} \item Composizione superficiale \item modelli idrodinamici dell'atmosfera e inclusione di effetti NLTE \item Effetto screening degli elettroni sulle reazioni nucleari\end{itemize*} };

\end{tikzpicture}

}

\end{document}
