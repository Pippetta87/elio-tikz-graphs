% the tikz-er2.sty package is available at:
% http://tagus.inesc-id.pt/~pcalado/tikzer2/tikz-er2.
\documentclass[../main.tex]{subfiles}

\begin{document}

\thispagestyle{empty}

\tikzstyle{every entity} = [top color=white, bottom color=blue!30, 
                            draw=blue!50!black!100, drop shadow,text width=2cm]
\tikzstyle{every weak entity} = [drop shadow={shadow xshift=.7ex, 
                                 shadow yshift=-.7ex}]
\tikzstyle{every attribute} = [top color=white, bottom color=yellow!20, 
                               draw=yellow, node distance=1cm, drop shadow,text width=1.5cm]
\tikzstyle{every relationship} = [top color=white, bottom color=red!20, 
                                  draw=red!50!black!100, drop shadow,text width=2cm]
\tikzstyle{every isa} = [top color=white, bottom color=green!20, 
                         draw=green!50!black!100, drop shadow,text width=2cm]

\centering
\scalebox{.25}{
\begin{tikzpicture}[node distance=1.5cm, every edge/.style={link}]

  \node[entity] (ssm) at (0,0) {SSM};
\draw[link,<-]  (ssm.120)--++(120:2cm) node[attribute] (hydro) {Equilibrio idrostatico};
\draw[link,<-]  (ssm.160)--++(160:2cm) node[attribute] (thermal) {Equilibrio termico locale};
\draw[link,<-]  (ssm.200)--++(200:2cm) node[attribute] (opacity) {Equilibrio radiativo + criterio di Schwartzchild};

\node[relationship] (calibration) [above =1.5cm of ssm] {Calibrazione luminosit\'a e raggio} edge[<-] (ssm);

\node[entity] (unphys) [above right=1cm and 2cm of ssm] {Incertezze fisica del modello} edge [<-] (ssm);
\node[entity] (corrections) [left=3cm of ssm] {Correzioni} edge [->] (ssm);

\node[entity] (surfaceobs) [above right=1cm and 1cm of calibration] {Osservabili stellari};
\draw[link,->] (surfaceobs.90)--++(90:2cm) node[attribute] {Misura metellicit\'a superficiale};

\node[entity] (modelobs) [left=3cm of surfaceobs] {Discrepanze modello/osservazioni} edge [->] (corrections);
\node[entity,anchor=north west] (sismobs) at (surfaceobs.south east) {Osservabili sismologiche};
\draw[link,<->]  (sismobs.20)--++(30:3cm) node[attribute] (freqs) {Frequenze oscillazioni adiabatiche};
\draw[link,<->] (sismobs.5)--++(5:2cm) node[attribute] (radiuscz) {Raggio fondo zona convettiva};

\draw[link,<->] (surfaceobs.180) -- (unphys.170) node [pos=0.8, left] (stellaracc) {accuratezza};
\draw[link,<->] (sismobs.340) -- (unphys.20) node [pos=0.2, right] (sismacc) {accuratezza};

\node[draw,purple,fit=(hydro)(thermal)(opacity)(ssm),ellipse,label={[purple,label distance=1cm]150:Modello Solare standard}] (ssmapprox) at (hydro.west) {};
\node[entity,anchor=north east] (ssmapproxlist) at (ssmapprox.west) { \begin{itemize*} \item Composizione superficiale \item modelli idrodinamici dell'atmosfera e inclusione di effetti NLTE \item Effetto screening degli elettroni sulle reazioni nucleari\end{itemize*} };

\end{tikzpicture}

}

\end{document}
